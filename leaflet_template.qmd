---
title: "Leaflet Template Combining R and Javascript"
format: html
---

***R creates the content and data***\
***JS controls behavior and interaction***\
***CSS controls appearance and layout***



```{r}
#| echo: FALSE
#| results: asis

# this block enables the javascript used on this page
if(file.exists("leaflet-control.js")) {
  cat("<!-- JS file exists -->\n")
  cat('<script src="leaflet-control.js"></script>\n')
} else {
  cat("<!-- Warning: js not found -->\n")
  cat('<script>
    console.log("Temporary JS loaded");
    document.addEventListener("DOMContentLoaded", function() {
        console.log("Document ready from temporary JS");
    });
  </script>\n')
}
```


## Single Map
```{r}
# load packages
library(leaflet)
library(leaflet.extras)

# load maps
map2 <- leaflet() %>%
  setView(lng = 4.4777, lat = 51.9244, zoom = 13) %>%
  addTiles() %>%  # Base OSM layer
  addTiles(
    urlTemplate = "https://allmaps.xyz/maps/8ebee9ef638a08cf/{z}/{x}/{y}.png",
    attribution = "Allmaps",
    options = tileOptions(opacity = 0.7)  # Optional: make it semi-transparent
  ) |> 
  addFullscreenControl()
map2
```



## Side-By-Side Map
```{r}
library(leaflet)
library(htmlwidgets)

m1 <- leaflet() |>
addTiles() |>
setView(lng = 4.9, lat = 52.37, zoom = 12)

m2 <- leaflet() |>
addTiles() |>
setView(lng = 4.9, lat = 52.37, zoom = 10)

m1
m2

m1 <- m1 |> onRender("
function(el, x) {
el.id = 'map1';
}
")

m2 <- m2 |> onRender("
function(el, x) {
el.id = 'map2';
}
")

```


<button onclick="toggleDualFullscreen()">
  Toggle dual fullscreen
</button>


## Side-By-Side Map, scale and pan synchronized
::: {.map-wrapper}

<button class="fullscreen-btn" onclick="toggleMapsFullscreen()">
â›¶ Fullscreen
</button>

::: {#map-container}
::: {.map-panel}
```{r echo=FALSE}
library(leaflet)

leaflet() %>%
  addTiles() %>%
  setView(4.9, 52.37, 8) %>%
  htmlwidgets::onRender("
    function(el, x) {
      const map = this;
      requestAnimationFrame(() => map.invalidateSize());
      setTimeout(() => map.invalidateSize(), 300);
    }
  ")
```
:::

::: {.map-panel}
```{r echo=FALSE}
leaflet() %>%
  addTiles() %>%
  setView(13.4, 52.52, 8) %>%
  htmlwidgets::onRender("
    function(el, x) {
      const map = this;
      requestAnimationFrame(() => map.invalidateSize());
      setTimeout(() => map.invalidateSize(), 300);
    }
  ")
```
:::
:::
:::
